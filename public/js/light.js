// Generated by CoffeeScript 1.6.3
(function() {
  var add_values, client, get_control, get_parametered_input, get_tile;

  window._id = 0;

  window._act = function(dest, key) {
    return window._pub(dest.replace(/\/values/, ''), key);
  };

  get_tile = function(dest, key, value) {
    return "<div class='tiles' style='display: inline;'><div class=    'small tile'><i class='icon-" + key + "' onclick='    window._act(\"" + dest + "\", \"" + key + "\");'></i></div></div>";
  };

  get_parametered_input = function(dest, key, value) {
    var k, str, v, _ref;
    str = "";
    _ref = value["parameters"];
    for (k in _ref) {
      v = _ref[k];
      str += "<p><input placeholder='" + k + "'         id='" + window._id + "' name='" + k + "'/></p>";
    }
    str += "<input type='button' onclick='window._act(\"" + dest + "\",    \"" + key + " \" + $(\"#\" + " + window._id + ").val())' value='" + key + "'>";
    window._id++;
    return str;
  };

  get_control = function(dest, key, value) {
    if (value['parameters'] != null) {
      return get_parametered_input(dest, key, value);
    } else {
      return get_tile(dest, key, value);
    }
  };

  add_values = function(msg) {
    var k, v, _ref, _results;
    console.log(msg);
    _ref = $.parseJSON(msg.payloadString);
    _results = [];
    for (k in _ref) {
      v = _ref[k];
      _results.push($("#content").append(get_control(msg.destinationName, k, v)));
    }
    return _results;
  };

  window._pub = function(topic, str) {
    var message;
    console.log(topic, str);
    message = new Messaging.Message(str);
    message.destinationName = topic;
    return window._cli.send(message);
  };

  client = new Messaging.Client("127.0.0.1", 8080, "clientId");

  window._cli = client;

  client.onConnectionLost = function(response) {
    return console.log(response);
  };

  client.onMessageArrived = function(message) {
    if (/\/values/.test(message.destinationName)) {
      return add_values(message);
    }
  };

  client.connect({
    onSuccess: function() {
      client.subscribe("/home/actuators/#");
      return window._pub("/home/actuators", "list");
    },
    onFailure: function(e) {
      return console.log(e);
    }
  });

}).call(this);
